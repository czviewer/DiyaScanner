<!DOCTYPE html>
<html>
<head>
  <title>OTP Test - Firebase Modular</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // ‚úÖ Replace with your own Firebase config
    const firebaseConfig = {
            apiKey: "AIzaSyBU3K7gRzqiqQt3o9thoEpd06ReLGVmm_w",
            authDomain: "diya-hero.firebaseapp.com",
            databaseURL: "https://diya-hero-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "diya-hero",
            storageBucket: "diya-hero.firebasestorage.app",
            messagingSenderId: "455829653263",
            appId: "1:455829653263:web:5a31c65bdab2b9cee0607a",
            measurementId: "G-DZYHPLQD3F"
        };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    let confirmationResult;

    window.onload = () => {
      window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
        size: 'invisible',
        callback: () => {
          console.log("reCAPTCHA verified");
        },
        'expired-callback': () => {
          alert("reCAPTCHA expired. Try again.");
        }
      });
      recaptchaVerifier.render().then(widgetId => {
        window.recaptchaWidgetId = widgetId;
      });

      document.getElementById('sendOtpBtn').addEventListener('click', async () => {
        const phone = document.getElementById('phoneNumber').value;
        const appVerifier = window.recaptchaVerifier;
        try {
          confirmationResult = await signInWithPhoneNumber(auth, phone, appVerifier);
          document.getElementById('statusMsg').innerText = '‚úÖ OTP Sent!';
        } catch (error) {
          console.error(error);
          document.getElementById('statusMsg').innerText = '‚ùå Error: ' + error.message;
        }
      });

      document.getElementById('verifyOtpBtn').addEventListener('click', async () => {
        const otp = document.getElementById('otpInput').value;
        try {
          const result = await confirmationResult.confirm(otp);
          document.getElementById('statusMsg').innerText = '‚úÖ Success! Phone: ' + result.user.phoneNumber;
        } catch (error) {
          console.error(error);
          document.getElementById('statusMsg').innerText = '‚ùå Invalid OTP: ' + error.message;
        }
      });
    };
  </script>
</head>
<body>
  <h2>üì≤ Firebase OTP Test (Modular SDK)</h2>

  <input type="tel" id="phoneNumber" placeholder="+91xxxxxxxxxx" />
  <button id="sendOtpBtn">Send OTP</button>
  <br><br>

  <div id="recaptcha-container"></div>

  <input type="text" id="otpInput" placeholder="Enter OTP" />
  <button id="verifyOtpBtn">Verify OTP</button>

  <p id="statusMsg"></p>
</body>
</html>
